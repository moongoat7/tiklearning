<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LearningTok â€” AI Feed</title>
  <meta name="description" content="LearningTok: AI-generated learning feed with quizzes â€” single-file static demo." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <style>
    html,body{
      background: radial-gradient(ellipse at top, rgba(255,255,255,0.06), transparent 60%), linear-gradient(#0a0a0a,#000);
      min-height:100%;
    }
  </style>
</head>
<body class="min-h-screen text-white">
  <div id="root"></div>

<script>
const { useState, useRef } = React;

// ×¤×•× ×§×¦×™×” ×œ×™×¦×•×¨ ××™×™×˜× ×‘×¢×–×¨×ª ×§×¨×™××” ×œ-API (/api/generate ×•-/api/generate-video)
async function createAiItem(topic, level, duration) {
  // 1. ×‘×§×©×ª ×ª×¡×¨×™×˜ ×•×©××œ×•×Ÿ ×ž-OpenAI
  const body = { topic, level, duration: parseInt(duration, 10) || duration };
  const resp = await fetch('/api/generate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });
  const data = await resp.json();
  if (!resp.ok) {
    throw new Error(data.error || 'OpenAI API failed');
  }

  // 2. ×‘×§×©×ª ×¡×¨×˜×•×Ÿ D-ID ×œ×¤×™ ×”×ª×¡×¨×™×˜ ×©×—×–×¨
  const videoResp = await fetch('/api/generate-video', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ script: data.script })
  });
  const videoData = await videoResp.json();
  if (!videoResp.ok) {
    throw new Error(videoData.error || 'Video API failed');
  }

  // 3. ×”×—×–×¨×ª ×¤×¨×™×˜ ×—×“×© ×œ×¤×™×“ ×¢× ×”×¡×¨×˜×•×Ÿ ×•×”×©××œ×•×Ÿ
  return {
    id: String(Date.now()),
    topic,
    level,
    duration: typeof duration === 'number' ? `${duration} ×©× ×™×•×ª` : duration,
    script: data.script,
    videoUrl: videoData.videoUrl,
    quiz: data.quiz
  };
}

function Header({ onImport, onExport, onReset }) {
  return (
    React.createElement('div',{className:'px-4 pt-4 pb-2 flex items-center justify-between'},
      React.createElement('div',{className:'flex items-center gap-3'},
        React.createElement('div',{className:'w-9 h-9 rounded-xl bg-white/10 flex items-center justify-center font-bold'},'LT'),
        React.createElement('div',null,
          React.createElement('div',{className:'text-sm font-semibold'},'LearningTok'),
          React.createElement('div',{className:'text-xs text-white/60'},'×¤×™×“ ×œ×™×ž×•×“×™ ×‘×¡×’× ×•×Ÿ ×˜×™×§×˜×•×§')
        )
      ),
      React.createElement('div',{className:'flex items-center gap-2'},
        React.createElement('button',{onClick:onImport,className:'px-2 py-1 text-xs rounded-lg bg-white/10 hover:bg-white/20'},'×™×™×‘×•×'),
        React.createElement('button',{onClick:onExport,className:'px-2 py-1 text-xs rounded-lg bg-white/10 hover:bg-white/20'},'×™×™×¦×•×'),
        React.createElement('button',{onClick:onReset,className:'px-2 py-1 text-xs rounded-lg bg-white/10 hover:bg-white/20'},'××™×¤×•×¡')
      )
    )
  );
}

function Setup({ onCreate }){
  const [topic,setTopic] = useState('×ž×‘×•× ×œ×¤×™×™×ª×•×Ÿ');
  const [level,setLevel] = useState('×‘×¡×™×¡×™');
  const [duration,setDuration] = useState('15 ×©× ×™×•×ª');
  const [busy,setBusy] = useState(false);

  const handleCreate = async () => {
    setBusy(true);
    try {
      const item = await createAiItem(topic, level, duration);
      onCreate(item);
    } catch(err) {
      alert('×©×’×™××” ×‘×™×¦×™×¨×ª ×ª×•×›×Ÿ: ' + err.message);
    } finally {
      setBusy(false);
    }
  };

  return (
    React.createElement('div',{className:'p-4 max-w-[480px] mx-auto'},
      React.createElement('div',{className:'text-lg font-semibold mb-2'},'×¦×•×¨ ×¡×¨×˜×•×Ÿ AI ×¨××©×•×Ÿ'),
      React.createElement('label',{className:'block text-sm mb-1'},'× ×•×©×'),
      React.createElement('input',{value:topic,onChange:e=>setTopic(e.target.value),placeholder:'×ž×” ××ª×” ×¨×•×¦×” ×œ×œ×ž×•×“?',className:'w-full px-3 py-2 rounded-lg bg-white/10 border border-white/10 mb-3'}),
      React.createElement('div',{className:'grid grid-cols-2 gap-2 mb-3'},
        React.createElement('div',null,
          React.createElement('label',{className:'block text-sm mb-1'},'×¨×ž×”'),
          React.createElement('select',{value:level,onChange:e=>setLevel(e.target.value),className:'w-full px-3 py-2 rounded-lg bg-white/10 border border-white/10'},
            React.createElement('option',null,'×‘×¡×™×¡×™'),
            React.createElement('option',null,'×‘×™× ×•× ×™'),
            React.createElement('option',null,'×ž×ª×§×“×')
          )
        ),
        React.createElement('div',null,
          React.createElement('label',{className:'block text-sm mb-1'},'××•×¨×š ×ž×©×•×¢×¨'),
          React.createElement('select',{value:duration,onChange:e=>setDuration(e.target.value),className:'w-full px-3 py-2 rounded-lg bg-white/10 border border-white/10'},
            React.createElement('option',null,'15 ×©× ×™×•×ª'),
            React.createElement('option',null,'30 ×©× ×™×•×ª'),
            React.createElement('option',null,'60 ×©× ×™×•×ª')
          )
        )
      ),
      React.createElement('button',{onClick:handleCreate,disabled:busy,className:'w-full py-2 rounded-lg bg-white/20 hover:bg-white/30 disabled:opacity-60'},
        busy ? '×™×•×¦×¨â€¦' : '×¦×•×¨ ×¡×¨×˜×•×Ÿ AI'
      ),
      React.createElement('div',{className:'text-xs text-white/60 mt-2'},'×‘×œ×—×™×¦×” × ×™×¦×•×¨ ×ª×¡×¨×™×˜ ×•×©××œ×” ×‘×¢×–×¨×ª OpenAI ×•× ×¤×™×§ ×¡×¨×˜×•×Ÿ ×¢× Dâ€‘ID.')
    )
  );
}

function VideoCard({ item }) {
  const [picked, setPicked] = useState(null);
  const correct = picked !== null && picked === item.quiz.correctIndex;
  return (
    React.createElement('div',{className:'p-4 flex flex-col gap-3'},
      React.createElement('div',{className:'text-xs uppercase tracking-wider text-white/60'}, item.topic + ' â€¢ ' + item.level + ' â€¢ ' + item.duration),
      React.createElement('div',{className:'rounded-2xl overflow-hidden border border-white/10 bg-black/40'},
        React.createElement('video',{src:item.videoUrl, controls:true, className:'w-full h-56 object-cover'})
      ),
      React.createElement('div',{className:'text-sm text-white/80 bg-white/5 border border-white/10 rounded-xl p-3 whitespace-pre-wrap'}, item.script),
      React.createElement('div',{className:'mt-1 text-base font-semibold'}, item.quiz.prompt),
      React.createElement('div',{className:'grid gap-2'},
        ...item.quiz.choices.map((c,i)=>
          React.createElement('button',{
            key:i,
            onClick:()=>setPicked(i),
            className:'text-right p-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition ' + (picked===i ? (i===item.quiz.correctIndex ? 'ring-2 ring-green-400' : 'ring-2 ring-red-400') : '')
          }, React.createElement('div',{className:'text-sm font-medium'}, c))
        )
      ),
      picked!==null && React.createElement('div',{className:'mt-2 p-3 rounded-xl ' + (correct ? 'bg-green-500/10' : 'bg-red-500/10')},
        React.createElement('div',{className:'text-sm whitespace-pre-line'}, item.quiz.explain),
        React.createElement('div',{className:'text-xs text-white/60 mt-1'}, correct ? '×ª×©×•×‘×” × ×›×•× ×” ðŸ‘Œ' : '×œ× × ×•×¨×, × ×¡×” ×©×•×‘')
      )
    )
  );
}

function App(){
  const [feed, setFeed] = useState([]);
  const [draft, setDraft] = useState(null);
  const fileRef = useRef(null);

  const onCreate = (item) => setDraft(item);
  const addToFeed = () => { if(draft){ setFeed(f=>[draft, ...f]); setDraft(null);} };

  const onImport = ()=> fileRef.current?.click();
  const onFile = async (e)=>{
    const f = e.target.files?.[0]; if(!f) return;
    try{
      const text = await f.text();
      const data = JSON.parse(text);
      if(!Array.isArray(data)) throw new Error('JSON must be an array');
      setFeed(data);
    }catch(err){ alert('Import failed: '+err.message); }
    finally{ e.target.value=''; }
  };
  const onExport = ()=>{
    const blob = new Blob([JSON.stringify(feed, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'feed.json';
    a.click();
    URL.revokeObjectURL(a.href);
  };
  const onReset = ()=>{ setFeed([]); setDraft(null); };

  return (
    React.createElement('div',null,
      React.createElement(Header,{onImport,onExport,onReset}),
      React.createElement('input',{ref:fileRef,type:'file',accept:'application/json',className:'hidden',onChange:onFile}),
      React.createElement('div',{className:'py-6 px-4'},
        React.createElement('div',{className:'relative mx-auto max-w-[390px] h-[760px] rounded-[2.25rem] shadow-[0_10px_30px_rgba(0,0,0,0.25)] border border-white/10 overflow-hidden bg-gradient-to-b from-zinc-900 to-black'},
          React.createElement('div',{className:'absolute left-1/2 -translate-x-1/2 top-2 w-40 h-5 rounded-b-2xl bg-black/40'}),
          React.createElement('div',{className:'absolute inset-0 pointer-events-none bg-[radial-gradient(ellipse_at_top,rgba(255,255,255,0.06),transparent_60%)]'}),
          React.createElement('div',{className:'relative z-10 h-full flex flex-col'},
            !draft && React.createElement(Setup,{ onCreate }),
            draft && React.createElement('div',{className:'p-3 border-b border-white/10 bg-white/5'},
              React.createElement('div',{className:'text-sm font-semibold mb-2'},'×˜×™×•×˜×” × ×•×›×—×™×ª'),
              React.createElement(VideoCard,{ item:draft }),
              React.createElement('div',{className:'mt-2 flex justify-end'},
                React.createElement('button',{onClick:()=>setDraft(null),className:'px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 mr-2'},'×ž×—×§ ×˜×™×•×˜×”'),
                React.createElement('button',{onClick:addToFeed,className:'px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30'},'×”×•×¡×£ ×œ×¤×™×“')
              )
            ),
            React.createElement('div',{className:'flex-1 overflow-y-auto'},
              feed.length===0
              ? React.createElement('div',{className:'p-6 text-center text-white/60'},'×”×¤×™×“ ×¨×™×§. ×¦×•×¨ ×¡×¨×˜×•×Ÿ AI ×•×”×•×¡×£ ×œ×¤×™×“.')
              : feed.map((it, idx) =>
                  React.createElement('div',{key:it.id || idx, className:'border-b border-white/10'},
                    React.createElement(VideoCard,{ item:it })
                  )
                )
            )
          )
        )
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>
